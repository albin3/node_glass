#眼镜项目 -- 系统接口

-----
##注册登录接口

#### 用户注册

**方法**：POST  
**描述**：用户通过post用户信息注册  
**地址**：/appapi/newuser/

**POST参数：**

```
{
   nickname : "Amy",
   tel      : 11111111111,   // 下面三个选一个填
   email    : 1@gmail.com,
   thirdpath: xxxxxxxxxx,
   password : ********,
   ...                       // 其他信息  
}

```
**返回值**:

```
{
	"ret"      : 1/成功-2/字段已经被注册-3/员工ID错误，
	"userid"   : "531d6c87c6dbd52714000001"， // 注册成功时，附带消息
	"isworker" : 0/不是worker,1/是worker       // 注册成功时，附带是否为员工
}

```
#### 用户登录

**方法**：get/post  
**描述**：用户通过用户名和密码登录  
**地址**：/appapi/usersignin/<-type>/<-name>/<-password>

**POST参数：**

* <int:type>        : 1/tel-2/email-3/thirdpath,
* <string:name>     : 用户名,
* <string:password> : 密码

**返回值**:

```
{
	"ret"      : 1/登录成功-2/密码错误-3/账号封停-4/账号不存在,
	"userid"   : "531d6c87c6dbd52714000001",  // 注册成功时，附带消息
	"isworker" : 0/不是员工-1/是员工,           // 登录成功时才有这个字段
	 
}
```
#### 修改用户信息

**方法**：post  
**描述**：通过用户id和完整的用户信息字段更新用户信息  
**地址**：/appapi/updateuser/<-userid>

**POST参数：**

* <string:tel>     : 电话,
* <string:email>   : E-mail
* 待确认字段

**返回值**:

```
{
	"ret"      : 1/修改成功-2/tel或email已存在-3/账号停封-4/账号不存在,
	"userid"   : "531d6c87c6dbd52714000001",  // 注册成功时，附带消息
	"isworker" : 0/不是员工-1/是员工,           // 登录成功时才有这个字段
	 
}
```

#### 修改用户密码

**方法**：post/get
**描述**：通过用户id和旧密码、新密码  
**地址**：/appapi/chpassword/<-userid>/<-oldpassword>/<-newpassword>

**POST参数：**

* <-userid> 用户id[531d6c87c6dbd52714000001] 
* <-oldpassword> 用户旧密码 
* <-newpassword> 用户新密码

**返回值**:

```
{
	"ret"      : 1/修改成功-2/旧密码不正确-3/账号停封-4/账号不存在-5/数据库错误,
	"userid"   : "531d6c87c6dbd52714000001",  // 修改成功时，附带消息
	"isworker" : 0/不是员工-1/是员工,           // 修改成功时才有这个字段
	 
}
```

**测试**:

```
{
   get: url/appapi/chpassword/53210cc0387f09250a000001/1/s
   
   返回：
   {
     "ret":1,
     "userid":"53210cc0387f09250a000001",
     "isworker":0
   }
}
```

#### 重置用户密码

**方法**：post/get
**描述**：通过用户id重置密码
**地址**：/appapi/resetpassword/<-userid>

**POST参数：**

url中

* <-userid> 用户id[531d6c87c6dbd52714000001] 

**返回值**:

```
{
	"ret"      : 1/重置成功-3/账号停封-4/账号不存在-5/数据库错误,
	"userid"   : "531d6c87c6dbd52714000001",  // 重置成功时，附带消息
	"isworker" : 0/不是员工-1/是员工,           // 重置成功时才有这个字段
	"password" : "六位随机数",                 // 重置的密码
	 
}
```

**测试**:

```
{
   get: url/appapi/resetpassword/531fdd18f76e109213000002/
   
   返回：
   {
     "ret"     : 1,
     "val"     :
     "userid"  : "531fdd18f76e109213000002",
     "isworker": 0,
     "password": "238923"
   }
}
```

-----
##新闻接口

#### 焦点图片接口

**方法**：GET/POST
**描述**：获取到app首页的焦点轮询图  
**地址**：/appapi/newsfocuspic/<-num>/<-lan>
**参数**：无  

<-num>: 获取的焦点图张数
<-lan>: english,simplified,traditional

**返回值**：

```
{
  ret       :   2/数据库查询出错-1/成功，
  num       :   列表的个数
  list      :   [{
     _id  :  对象的id,
     title :  对象的标题,
     summary : 对象的简易描述,
      picture    :  图像链接
   },
   ...]
  
}   
```
**示例**

请求： /appapi/newsfocuspic/5/english

```
{       "ret":1,
        "num":3,
        "list":[{
             "_id":"53265dab060c3bfd12000001",
             "title":"descriptions",
             "summary":"descriptions",
             "picture":"/img/news/53265dab060c3bfd12000001.jpg"
             },{
             "_id":"53265f18c155bf0f13000003",
             "title":"descriptions",
             "summary":"descriptions",
             "picture":"/img/news/53265f18c155bf0f13000003.jpg"
             },{
             "_id":"53265f4ac155bf0f13000005",
             "title":"descriptions",
             "summary":"descriptions",
             "picture":"/img/news/53265f4ac155bf0f13000005.jpg"
        }]
}

```

#### 新闻列表

**方法**：GET/POST
**描述**: 获取到所有新闻的列表  
**地址**：/appapi/newslist/<-numPerPage>/<-PageNum>/<-lan>
**参数**：无
**返回值**：
<-numPerPage>:每页的条数
<-PageNum>:第几页
<-lan>: english,simplified,traditional

```
// 说明：
{
    "ret"    :   2/查询出错-1/返回成功
    "num"    :   返回的列表数
	"list": [
		{
		    _id:    
			标题:
			导语:
			首图:
		}
		...
	]
}

```

```
// 示例：
请求： http://127.0.0.1:3006/appapi/newslist/2/1/english
返回：
{     "ret":1,
      "num":2,
      "list":[{
          "_id":"53265dab060c3bfd12000001",
          "summary":"导语",
          "title":"标题",
          "pic":"/img/news/53265dab060c3bfd12000001.jpg"
          },{
          "_id":"53265f17c155bf0f13000001",
          "summary":"导语",
          "title":"标题",
          "pic":"/img/news/53265f17c155bf0f13000001.jpg"
          }]
}

```

#### 获取新闻详情
**方法**：POST/GET
**描述**：获取到某个新闻的详情  
**地址**：/appapi/newsdetails/<news_id>

**参数**：无

* news_id: 上一个接口里的 "_id"

**返回值**:

```
// 说明：
{
    "ret": 1/成功-2/项目已经被删除-3/数据库查询出错,
	"obj":
		{
		    _id:
		    是否是焦点图新闻: 
			标题：
			导语：
			内容：
		}
}

// 示例：
请求： /appapi/newsdetails/53265dab060c3bfd12000001
回复：
{
      "ret":1,
      "obj":{
            "_id":"53265dab060c3bfd12000001",
            "focus":true,
            "title":"标题",
            "summary":"导语",
            "details":
            [{
                  "type":1,
                  "content":"这是一条新闻文本",
                  "des":""
                  },{
                  "type":2,
                  "content":"/img/news/53265dab060c3bfd120000011.jpg",
                  "des":"这是一个图片描述"
            }]
      }
}

```

-----
##游戏接口
####紫外线收割机

**方法**：POST
**描述**：游戏分数上传 
**地址**：/appapi/games/uvcatcher 

**参数**：

{
    _id      :   用户的_id,
    nickname :   用户昵称,
    score    :   用户的分数
}

**返回值**:

```
// 说明：
{
    "ret": 1/成功-2/失败
}

// 示例：
请求： /appapi/games/uvcatcher
{
    _id      : "53265dab060c3bfd12000001",
    nickname : "louding",
    score    : 18
}

回复更新成功：
{
      "ret":1,
}

```
####获取紫外线收割机排行榜

**方法**：POST/GET
**描述**：紫外线收割机排行榜
**地址**：/appapi/games/uvrank 

**参数**：
无

**返回值**:

```
// 说明：
{
    "ret"  : 1/成功-2/失败
    "rank" : [{	  // 按照分数降序排列
        _id      : 分数id,
        userid   : 用户id,
        nickname : 用户昵称,
        score    : 分数
    }
    ]
}

// 示例：
请求： /appapi/games/uvrank

回复更新成功：
{
      "ret":1,
      "rank" : [{
        _id      : "53265dab060c3bfd12000009",
        userid   : "53265dab060c3bfd12000001",
        nickname : "louding",
        score    : 18
    },{
        _id      : "53265dab060c3bfd12000018",
        userid   : "53265dab060c3bfd12000003",
        nickname : "louding",
        score    : 9
    }...
    ]
}

```

####寻找黄眼镜

**方法**：POST
**描述**：游戏分数上传 
**地址**：/appapi/games/findglass 

**参数**：

{
    _id      :   用户的_id,
    nickname :   用户昵称,
    score    :   用户的时间
}

**返回值**:

```
// 说明：
{
    "ret": 1/成功-2/失败
}

// 示例：
请求： /appapi/games/findglass
{
    _id      : "53265dab060c3bfd12000001",
    nickname : "louding",
    score    : 18
}

回复更新成功：
{
      "ret":1,
}

```
####寻找黄眼镜获取后台的图片

**方法**：POST/GET
**描述**：获取游戏后台图片 
**地址**：/appapi/games/findglass/pulldata/<- timestamp-> 

**参数**：
无

**返回值**:

```
// 说明：
{
    "ret"  : 1/成功-2/失败
    "pics" : 获取到的照片信息列表[时间降序排列]
}

// 示例：
请求： /appapi/games/findglass/pulldata/0

回复更新成功：
{
      "ret":1,
      "pics": [
		{
			picwidth: 6,
			picheight: 6,
			glasswidth: 6,
			glassheight: 6,
			dt: 1396432139994,
			_id: "533bdd0bec696a6c1e000001"
		},
		{
			picwidth: 3,
			picheight: 3,
			glasswidth: 3,
			glassheight: 3,
			dt: 1396431455706,
			_id: "533bda5ff47936fa1d000001"
		}...]
}

```
####获取紫外线收割机排行榜

**方法**：POST/GET
**描述**：寻找黄眼镜排行榜
**地址**：/appapi/games/fgrank 

**参数**：
无

**返回值**:

```
// 说明：
{
    "ret"  : 1/成功-2/失败
    "rank" : [{	  // 按照时间的升排列
        _id      : 分数id,
        userid   : 用户id,
        nickname : 用户昵称,
        score    : 时间
    }
    ]
}

// 示例：
请求： /appapi/games/fgrank

回复更新成功：
{
      "ret":1,
      "rank" : [{
        _id      : "53265dab060c3bfd12000009",
        userid   : "53265dab060c3bfd12000001",
        nickname : "louding",
        score    : 6
    },{
        _id      : "53265dab060c3bfd12000018",
        userid   : "53265dab060c3bfd12000003",
        nickname : "louding",
        score    : 9
    }...
    ]
}

```

-----


##优惠券接口
####获得优惠券
**方法**：POST
**描述**：优惠券抽奖
**地址**：/appapi/coupon/getcoupon 

**参数**：
{
    _id      : 用户ID,
    isworker : 是否是员工(纯数字)
}

**返回值**:

```
// 说明：
{
    "ret"       : 1/成功-2/失败
    "couponkey" : 优惠券的号码
}

// 示例：
请求： /appapi/coupon/getcoupon

回复更新成功：
{
      "ret"       : 1,
      "couponkey" : "S5000000000015065"
}

```

#### 验证优惠券（优惠券是否存在）

**方法**：POST  
**描述**：删除优惠券
**地址**：/api/coupon/checkcoupon

**参数**：

* couponkey : 优惠券key

**返回值**：

```

// 返回值
{
	ret  :  1/存在，2/不存在
}
```

#### 使用优惠券
**方法**：POST  
**描述**：删除优惠券
**地址**：/api/coupon/usecoupon

**参数**：

* couponkey : 优惠券key

**返回值**：

```

// 返回值
{
	ret  :  1/存在，2/使用失败，3/已使用，4/这张券不存在，5/这类券已过期，6/这类券不存在
}
```

#### 根据用户id返回优惠券列表
**方法**：GET  
**描述**：用户的优惠券列表
**地址**：/api/coupon/couponlist/<- userid ->

**参数**：
无

**返回值**：

```

// 返回值
{
    ret        :   1/成功，2/不成功,
	couponlist :   [{
		"_id"       : "531d6c87c6dbd52714000001",
		"userid"    : "531d6c87c6dbd52714000003",
	    "couponkey" : "S5000000000040651",
	    detail      : "苏宁买商品时9折优惠",
        index       : "S5000",
        name        : "苏宁",
        off         : "5000",
        range       : "全国",
        time        : 1609344000000
	},
	...
	]
}
```

#### 获取地区
**方法**：GET  
**描述**：获取全国所有的省，市，区
**地址**：/appapi/regional

**参数**：
无

**返回值**：

```

// 返回值
{
    ret        :   1/成功，2/不成功,
    regional   :   [{
		"index"   : 110101,
		"area"    : "新华区",
	    "municipality"    : "河北省",
	    "province"  : "石家庄市",
	},
	...
	]
}
```

#### 获取随机数接口

**方法**：GET  
**描述**：获取随机数  
**地址**：/appapi/random

**参数**：无

**返回值**:

```

// 返回结果：
{
	"ret":1,
	"num":0.5
}
```

#后面的接口待更新 4-8/2014 Albin.


-----

#### 紫外线强度接口

**方法**：GET  
**描述**：通过接口查询紫外线强度  
**地址**：/api/uvindex

**参数**：无

**返回值**:

```

// 返回结果：
{
	"uvindex": 123
}
```


